<ossec_config>
  <global>
    <email_notification><%= @ossec_emailnotification %></email_notification>
    <% @ossec_emailto.each do |emailto| -%>
    <email_to><%= emailto %></email_to>
    <% end -%>
    <smtp_server><%= @mailserver_ip %></smtp_server>
    <email_from><%= @ossec_emailfrom %></email_from>
    <email_maxperhour><%= @ossec_email_maxperhour %></email_maxperhour>
    <% unless @ossec_email_idsname.nil? -%>
<email_idsname><%= @ossec_email_idsname %></email_idsname>
    <% end -%>
<stats><%= @ossec_global_stat_level %></stats>

    <host_information><%= @ossec_global_host_information_level %></host_information>
    <% @ossec_white_list.each do |ipaddress| -%><white_list><%= ipaddress %></white_list>
    <% end %>
  </global>

<% if @syslog_output == true then -%>
  <syslog_output>
    <server><%= @syslog_output_server %></server>
    <format><%= @syslog_output_format %></format>
  </syslog_output>
<% end -%>

  <ruleset>
    <!-- Default ruleset -->
    <decoder_dir>ruleset/decoders</decoder_dir>
    <rule_dir>ruleset/rules</rule_dir>
    <rule_exclude>0215-policy_rules.xml</rule_exclude>
    <list>etc/lists/audit-keys</list>

    <!-- User-defined ruleset -->
    <decoder_dir>etc/decoders</decoder_dir>
    <rule_dir>etc/rules</rule_dir>
  </ruleset>

  <!-- Most of these rules are defined in the shared agent config -->
  <syscheck>
    <!-- Frequency that syscheck is executed -->
    <frequency><%= @ossec_check_frequency %></frequency>
    <alert_new_files>yes</alert_new_files>
    <auto_ignore><%= @ossec_auto_ignore %></auto_ignore>

   <!-- Directories to check  (perform all possible verifications) -->
   <% @ossec_scanpaths.each do |scanpath| -%>    <directories check_all="yes" report_changes="<%= scanpath["report_changes"] %>" realtime="<%= scanpath['realtime'] %>"><%= scanpath['path']  %></directories>
<% end -%>

    <!-- Files/directories to ignore (parameterized) -->
<% @ossec_ignorepaths.each do |path| -%>
    <ignore><%= path %></ignore>
<% end -%>
<% if @ossec_prefilter == true then %>
    <prefilter_cmd>/usr/sbin/prelink -y</prefilter_cmd>
<% end %>
  </syscheck>

<% if @ossec_rootcheck == false then -%>
  <rootcheck>
    <disabled>yes</disabled>
  </rootcheck>
<% end -%>
<% if @ossec_active_response == false then -%>
  <active-response>
    <disabled>yes</disabled>
  </active-response>
<% end -%>

  <remote>
    <connection>secure</connection>
    <port><%= @ossec_server_port %></port>
  </remote>

  <alerts>
    <log_alert_level>1</log_alert_level>
	<email_alert_level><%= @ossec_email_alert_level %></email_alert_level>
  </alerts>

  <!-- Files to monitor (localfiles) -->
<% @ossec_local_files.each do |path, format| -%>
  <localfile>
    <log_format><%= format %></log_format>
    <location><%= path %></location>
  </localfile>
<% end -%>
