---
driver:
  name: docker
  use_sudo: false
  use_internal_docker_network: true
  remove_images: true

provisioner:
  name: puppet_apply
  manifests_path: manifests
  modules_path: modules
  hiera_data_path: hieradata

platforms:
  - name: ubuntu-18_manager_kitchen_puppet
    driver_config:
      image: jrei/systemd-ubuntu:18.04
      platform: ubuntu
      hostname: manager_wazuh
      run_command: /sbin/init
      privileged: true
      volume:
        - /sys/fs/cgroup:/sys/fs/cgroup:ro
      provision_command:
        - sed -i 's/UsePAM yes/UsePAM no/g' /etc/ssh/sshd_config

  - name: centos-7_agent_kitchen_puppet
    driver_config:
      image: centos/systemd:latest
      platform: centos
      hostname: agent_wazuh
      run_command: /usr/sbin/init
      privileged: true
      volume:
        - /sys/fs/cgroup:/sys/fs/cgroup:ro
      provision_command:
        - sudo yum install openssl -y
        - sed -i 's/UsePAM yes/UsePAM no/g' /etc/ssh/sshd_config

suites:
  - name: mngr
    manifest: site.pp
    verifier:
      name: inspec
    includes:
      - ubuntu-18_manager_kitchen_puppet

  - name: agent
    manifest: site.pp
    verifier:
      name: inspec
    includes:
      - centos-7_agent_kitchen_puppet
